#include "gfp_convert_search_api/gfp_convert_search_api.h"
#include <string.h>

#define SYS_LOG_NO_NEWLINE
#ifdef SYS_LOG_DOMAIN
#undef SYS_LOG_DOMAIN
#endif
#define SYS_LOG_DOMAIN "gfp_convert_search_api"
#include <logging/sys_log.h>

/* 	SKU	Color ID	Model ID	Public Key	Private Key
1	JBL Charge 6 Black	0x01	0x49327D	sLXDE1lBr/uFSv9EOeqXLD8vV14vLKLrPZT+u9P7jSidGMEpK+Y2ZmBxdB7/+UcjNaoQWvv3/OjeQeBz1jRpHg==	BBPIz+o6TaZdw16CAaL0+3HgNgZHHeMfH0EnlkM/17c=
2	JBL Charge 6 Red	0x02	0x867568	7KiyZcq3x35V4y7aqwfyKVaplMpGD4PLqFa/M9pn+Upvlt2bcWIAFtzjrFfLms42VoXgca94Y/wvWwPgpm78LA==	/umSPir72PF9+guC4Gkq2KPAy477Thjq/VVsGScBIJg=
3	JBL Charge 6 Blue	0x03	0x2D5F24	xQGCvab+LRM7aeMC63WRNex9S1s4aJCnWFw0l1m0phkwbEsKpNw5/A0H24E10EPGvwLWRLVJuV3N+Z+FPOXm4A==	G0IipziHQa6YPSiI6mIRDcblYYSjZl0bujabF9f2erY=
4	JBL Charge 6 White	0x04	0xB1BB91	ynXp6QNzZ85T92nsHqXL51XsCadxeSiTc6vbeZwQiUR7DaeHvYAn5CdmHmUhf7NpewZ6BEYQ6GkH4XVk5c4h8w==	jE8kdA0Cv98xE7KKnBijUu+nyPgfJg99lduzOefXRFM=
5	JBL Charge 6 Sand	0x08	0x0FB376	PVWNduFQhGCAkKeQl4tzz/KA/D/cx/yOHnpDq9YfZYyjZQRxVtQvNE38MEHUqr2NheRa+JaDYN0qoA968eMvEw==	wUUL5Pra0gzBoxLlpJOh8keAWM8fxwGl2+qp1/AZZDU=
6	JBL Charge 6 Pink	0x10	0x4C5DB7	s3WxHc7dqCKGMTfzsgk9W+l81hX1KzA9E7Dc71WoKv/biWyJQd5Upfd9Bhp0ghiY3+HCVeRJ5n0BUqx7qJVXnQ==	7LsIB36j27HpLRkAxEBbwDQKKrz4t4ydYnmdD5/bj/c=
7	JBL Charge 6 Camouflage	0x13	0xBC9091	iboWC/3Wb/zT4dLk/pOs9KX/AjtsxFBQwLfc3MljNEDpgdDrACorfrHVNd6rDbF97gqw33PB0+yJnUxqbSlftg==	hl+2i6KTW1FGtmzd4DT/n+2L4qN27gErFDjxzkVkXXY=
8	JBL Charge 6 Purple	0x14	0x814C5F	btvmHHItEYh/tUgmmC0Od8RqgWWtvFVY6Cn0ItxF78IaxElKZak7LRz2BDWHGD6YDbX7DYvN9J2d+HX6S5/SBw==	2cKlahtIl8BYV26IvvLfS38UadiAgHzUEtcExl0LDfQ=
9	JBL Charge 6 Funky Black	0x15	0x742E52	88l3dGaTAx9RmIT4GFqGjxR7hVsO/vyYPHz36yEq0uiU3sb2vV6LIOdhMpSAfqsog+YY85WwxFC3FPekG0oLZw==	H8rpXTaRkdc8eHA0CgeBWBx1MwRgf1LfBP8/glN0zDw=
10	JBL Charge 6 BakColor-1		0xA26B89	OS54w4YHWCP8HlECgr7w/S73TmoZE4RCMZG4V+7iukJiv0i85fQOF1tXBE/WCgejkI+f3R69YpeP8pgn5mOZIw==	R178+7QXY+7SAJzGvbNOjdB4a6lAjC52SW5BwMiUKQA=
11	JBL Charge 6 BakColor-2		0xA11718	Yv3d9c9WlCmCBW/XcgVK6DjwnLasUjrV7WaSmg0iSfQpEm2mctcSfqWlVv0blB3cJa6G/GQLfm2T8Aj20sqCvg==	JT7BQdofVWR/5cw00FS+Z0131Gj7rk9htJzlyvBj+0Y=
12	JBL Charge 6 BakColor-3		0x8FE661	S94e6hnrU2ZCiryOwX6UcSv2c55hp5nExiWRppBCCv0n1HOAFMdj9CfEEXpg0pkqo0Ye/sMd+KdxffyfyaAclg==	zumBHTe4Ixmp+jWOx1oaO1QKMYdJGWe2A2Ir3acxjZA=
13	JBL Charge 6 BakColor-4		0x82C643	NHkszrwz5qTQwiEKgpGUcVDvS48tlAlGDoEN0V+OYSOCPVGw2Bf4DfCFBqq2rek1eVxrinY44VvoE3jBaLS34w==	KiEgPh6b91976ay/KDnQEv2ShzUHkW4uIUuS9+R0v+M=
14	JBL Charge 6 BakColor-5		0xB85FBC	jnnNzGsjJL2LziGJeSQ2talXEp7DBYI4cqhaYnQjTNDs4lX/LJkyVI9LKSCy+dYqrSBA/w2zNRdzzl77ySNECA==	u9e05tVs2auczuK/tYpJhsFsCKR5vTa3mPm16dA1bPA=
	 */				


static const struct gfp_model_id_convert_search_table_element_type gfp_model_id_convert_search_table[] =
{
    { .model_id = {0x49, 0x32, 0x7D}, .private_key = "BBPIz+o6TaZdw16CAaL0+3HgNgZHHeMfH0EnlkM/17c=", .private_key_base64 = {0x04,0x13,0xc8,0xcf,0xea,0x3a,0x4d,0xa6,0x5d,0xc3,0x5e,0x82,0x01,0xa2,0xf4,0xfb,0x71,0xe0,0x36,0x06,0x47,0x1d,0xe3,0x1f,0x1f,0x41,0x27,0x96,0x43,0x3f,0xd7,0xb7} },
    { .model_id = {0x86, 0x75, 0x68}, .private_key = "/umSPir72PF9+guC4Gkq2KPAy477Thjq/VVsGScBIJg=", .private_key_base64 = {0xfe,0xe9,0x92,0x3e,0x2a,0xfb,0xd8,0xf1,0x7d,0xfa,0x0b,0x82,0xe0,0x69,0x2a,0xd8,0xa3,0xc0,0xcb,0x8e,0xfb,0x4e,0x18,0xea,0xfd,0x55,0x6c,0x19,0x27,0x01,0x20,0x98} },
    { .model_id = {0x2D, 0x5F, 0x24}, .private_key = "G0IipziHQa6YPSiI6mIRDcblYYSjZl0bujabF9f2erY=", .private_key_base64 = {0x1b,0x42,0x22,0xa7,0x38,0x87,0x41,0xae,0x98,0x3d,0x28,0x88,0xea,0x62,0x11,0x0d,0xc6,0xe5,0x61,0x84,0xa3,0x66,0x5d,0x1b,0xba,0x36,0x9b,0x17,0xd7,0xf6,0x7a,0xb6} },
    { .model_id = {0xB1, 0xBB, 0x91}, .private_key = "jE8kdA0Cv98xE7KKnBijUu+nyPgfJg99lduzOefXRFM=", .private_key_base64 = {0x8c,0x4f,0x24,0x74,0x0d,0x02,0xbf,0xdf,0x31,0x13,0xb2,0x8a,0x9c,0x18,0xa3,0x52,0xef,0xa7,0xc8,0xf8,0x1f,0x26,0x0f,0x7d,0x95,0xdb,0xb3,0x39,0xe7,0xd7,0x44,0x53} },
    { .model_id = {0x0F, 0xB3, 0x76}, .private_key = "wUUL5Pra0gzBoxLlpJOh8keAWM8fxwGl2+qp1/AZZDU=", .private_key_base64 = {0xc1,0x45,0x0b,0xe4,0xfa,0xda,0xd2,0x0c,0xc1,0xa3,0x12,0xe5,0xa4,0x93,0xa1,0xf2,0x47,0x80,0x58,0xcf,0x1f,0xc7,0x01,0xa5,0xdb,0xea,0xa9,0xd7,0xf0,0x19,0x64,0x35} },
    { .model_id = {0x4C, 0x5D, 0xB7}, .private_key = "7LsIB36j27HpLRkAxEBbwDQKKrz4t4ydYnmdD5/bj/c=", .private_key_base64 = {0xec,0xbb,0x08,0x07,0x7e,0xa3,0xdb,0xb1,0xe9,0x2d,0x19,0x00,0xc4,0x40,0x5b,0xc0,0x34,0x0a,0x2a,0xbc,0xf8,0xb7,0x8c,0x9d,0x62,0x79,0x9d,0x0f,0x9f,0xdb,0x8f,0xf7} },
    { .model_id = {0xBC, 0x90, 0x91}, .private_key = "hl+2i6KTW1FGtmzd4DT/n+2L4qN27gErFDjxzkVkXXY=", .private_key_base64 = {0x86,0x5f,0xb6,0x8b,0xa2,0x93,0x5b,0x51,0x46,0xb6,0x6c,0xdd,0xe0,0x34,0xff,0x9f,0xed,0x8b,0xe2,0xa3,0x76,0xee,0x01,0x2b,0x14,0x38,0xf1,0xce,0x45,0x64,0x5d,0x76} },
    { .model_id = {0x81, 0x4C, 0x5F}, .private_key = "2cKlahtIl8BYV26IvvLfS38UadiAgHzUEtcExl0LDfQ=", .private_key_base64 = {0xd9,0xc2,0xa5,0x6a,0x1b,0x48,0x97,0xc0,0x58,0x57,0x6e,0x88,0xbe,0xf2,0xdf,0x4b,0x7f,0x14,0x69,0xd8,0x80,0x80,0x7c,0xd4,0x12,0xd7,0x04,0xc6,0x5d,0x0b,0x0d,0xf4} },
    { .model_id = {0x74, 0x2E, 0x52}, .private_key = "H8rpXTaRkdc8eHA0CgeBWBx1MwRgf1LfBP8/glN0zDw=", .private_key_base64 = {0x1f,0xca,0xe9,0x5d,0x36,0x91,0x91,0xd7,0x3c,0x78,0x70,0x34,0x0a,0x07,0x81,0x58,0x1c,0x75,0x33,0x04,0x60,0x7f,0x52,0xdf,0x04,0xff,0x3f,0x82,0x53,0x74,0xcc,0x3c} },
    { .model_id = {0xA2, 0x6B, 0x89}, .private_key = "R178+7QXY+7SAJzGvbNOjdB4a6lAjC52SW5BwMiUKQA=", .private_key_base64 = {0x47,0x5e,0xfc,0xfb,0xb4,0x17,0x63,0xee,0xd2,0x00,0x9c,0xc6,0xbd,0xb3,0x4e,0x8d,0xd0,0x78,0x6b,0xa9,0x40,0x8c,0x2e,0x76,0x49,0x6e,0x41,0xc0,0xc8,0x94,0x29,0x00} },
    { .model_id = {0xA1, 0x17, 0x18}, .private_key = "JT7BQdofVWR/5cw00FS+Z0131Gj7rk9htJzlyvBj+0Y=", .private_key_base64 = {0x25,0x3e,0xc1,0x41,0xda,0x1f,0x55,0x64,0x7f,0xe5,0xcc,0x34,0xd0,0x54,0xbe,0x67,0x4d,0x77,0xd4,0x68,0xfb,0xae,0x4f,0x61,0xb4,0x9c,0xe5,0xca,0xf0,0x63,0xfb,0x46} },
    { .model_id = {0x8F, 0xE6, 0x61}, .private_key = "zumBHTe4Ixmp+jWOx1oaO1QKMYdJGWe2A2Ir3acxjZA=", .private_key_base64 = {0xce,0xe9,0x81,0x1d,0x37,0xb8,0x23,0x19,0xa9,0xfa,0x35,0x8e,0xc7,0x5a,0x1a,0x3b,0x54,0x0a,0x31,0x87,0x49,0x19,0x67,0xb6,0x03,0x62,0x2b,0xdd,0xa7,0x31,0x8d,0x90} },
    { .model_id = {0x82, 0xC6, 0x43}, .private_key = "KiEgPh6b91976ay/KDnQEv2ShzUHkW4uIUuS9+R0v+M=", .private_key_base64 = {0x2a,0x21,0x20,0x3e,0x1e,0x9b,0xf7,0x5f,0x7b,0xe9,0xac,0xbf,0x28,0x39,0xd0,0x12,0xfd,0x92,0x87,0x35,0x07,0x91,0x6e,0x2e,0x21,0x4b,0x92,0xf7,0xe4,0x74,0xbf,0xe3} },
    { .model_id = {0xB8, 0x5F, 0xBC}, .private_key = "u9e05tVs2auczuK/tYpJhsFsCKR5vTa3mPm16dA1bPA=", .private_key_base64 = {0xbb,0xd7,0xb4,0xe6,0xd5,0x6c,0xd9,0xab,0x9c,0xce,0xe2,0xbf,0xb5,0x8a,0x49,0x86,0xc1,0x6c,0x08,0xa4,0x79,0xbd,0x36,0xb7,0x98,0xf9,0xb5,0xe9,0xd0,0x35,0x6c,0xf0} },
};

const struct gfp_model_id_convert_search_table_element_type *get_gfp_model_id_convert_search_table(void)
{
    return gfp_model_id_convert_search_table;
}

int get_gfp_model_id_convert_search_table_array_size(void)
{
    return ARRAY_SIZE(gfp_model_id_convert_search_table);
}

const u8_t *gfp_model_id_convert_to_private_key_base64(const u8_t *model_id)
{
    int i;

    for (i=0; i<get_gfp_model_id_convert_search_table_array_size(); i++)
    {
        if (!memcmp(gfp_model_id_convert_search_table[i].model_id, model_id, 3))
        {
            break;
        }
    }

    if (i == get_gfp_model_id_convert_search_table_array_size())
    {
        SYS_LOG_ERR("fail\n");
        return NULL;
    }

    SYS_LOG_INF("pkey_b64:0x%02X_%02X_%02X_%02X_%02X_%02X\n", 
        gfp_model_id_convert_search_table[i].private_key_base64[0], gfp_model_id_convert_search_table[i].private_key_base64[1],
        gfp_model_id_convert_search_table[i].private_key_base64[2], gfp_model_id_convert_search_table[i].private_key_base64[3],
        gfp_model_id_convert_search_table[i].private_key_base64[4], gfp_model_id_convert_search_table[i].private_key_base64[5]);

    // dump privte key base64 all ?
    // print_buffer(gfp_model_id_convert_search_table[i].private_key_base64, 1, sizeof(gfp_model_id_convert_search_table[i].private_key_base64), 16, 0);

    return gfp_model_id_convert_search_table[i].private_key_base64;
}

int gfp_model_id_convert_to_index(const u8_t *model_id)
{
    int i;

    for (i=0; i<get_gfp_model_id_convert_search_table_array_size(); i++)
    {
        if (!memcmp(gfp_model_id_convert_search_table[i].model_id, model_id, 3))
        {
            break;
        }
    }

    if (i == get_gfp_model_id_convert_search_table_array_size())
    {
        SYS_LOG_ERR("fail\n");
        return -1;
    }

    return i;
}
